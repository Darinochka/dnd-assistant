# ML System Design Doc - [RU]
## Дизайн ML системы - DND-assistant MPV
### 1. Цели и предпосылки
#### 1.1. Зачем идем в разработку продукта?

- **Бизнес-цель**

Сократить суммарное время подготовки и ведения сессии Dungeons & Dragons на 30–40 % для мастеров и на 20 % для игроков, одновременно повышая удовлетворённость (NPS ≥ 60) благодаря автоматизации рутинных задач.
- **Почему станет лучше, чем сейчас, от использования ML**

Модели LLM и retrieval-системы позволяют автоматически интерпретировать свободный текст игроков, подбирать релевантные правила и мгновенно генерировать сцены, NPC и сюжетные ветки, адаптируясь к стилю конкретного мастера. Без ML пришлось бы вручную готовить библиотеки сюжетов и вести справку, что не масштабируется и не реагирует на контекст в реальном времени. ML-подход обеспечивает персонализацию, консистентность лора и оперативный расчёт бросков/эффектов, снижая когнитивную нагрузку на участников и освобождая время для творчества.

- **Что будем считать успехом итерации с точки зрения бизнеса**

Итерация считается успешной, если за первый месяц пилота не менее 70 % мастеров проводят ≥2 сессий с ассистентом, среднее время подготовки снижается минимум на 30 %, а удовлетворённость пользователей достигает NPS ≥ 60. Дополнительно фиксируем рост числа активных кампаний на платформе на 15 % относительно контрольной группы.

#### 1.2. Бизнес-требования и ограничения

- Краткое описание БТ и ссылки на детальные документы с бизнес-требованиями
  - Mодель, с которой можно общаться. Она должна уметь составлять сцены, описание NPC и отвечать на вопросы по книге игрока.
  - Модель умеет общаться в голосовом формате
  - Доступна сразу в интерфейсе игры
  - Создание персонажа для игроков
- Бизнес-ограничения
  - Бюджет пилота ≤ $15k/мес, без хранения пользовательских логов больше 30 дней. Сюда входят: аренда GPU/LLM API с запасом по пиковым часам, поддержка разработчиков/ML-инженеров и обязательные затраты на мониторинг/логирование.
- Что мы ожидаем от конкретной итерации
  - MVP чат-ассистент с генерацией сцен, NPC, навигации в книге игрока
  - Базовый бот в мессенджере
- Описание бизнес-процесса пилота, насколько это возможно - как именно мы будем использовать модель в существующем бизнес-процессе?
  - Мастер запускает ассистента в интерфейсе кампании, вводит запросы в чат, получает сцены/NPC и прокидывает их игрокам через платформу.
- Что считаем успешным пилотом? Критерии успеха и возможные пути развития проекта
  - ≥200 активных сессий с ассистентом, сокращение времени на подготовку у мастеров не менее чем на 20%

#### 1.3. Что входит в скоуп проекта/итерации, что не входит

- На закрытие каких БТ подписываемся в данной итерации
  - Автоматизация генерации сцен/NPC при подготовке, подсказки по правилам.
  - Базовый интерфейс для мастера
- Что не будет закрыто
  - Голосовой интерфейс, создание персонажей для игроков, интерфейс общение в игре.
- Описание результата с точки зрения качества кода и воспроизводимости решения
  - Репозиторий с инфраструктурой для обучения и инференса, автотесты, шаблоны промптов и датасет.
- Описание планируемого технического долга
  - Отложенная оптимизация стоимости inference, доработка UX для игроков, автоматическое расширение знаний ассистента за пределы базового лора.

#### 1.4. Предпосылки решения

- **Данные**: правила D&D (Player's Handbook, DMG), примеры сцен/NPC из открытых источников, контекст текущей сессии/кампании. Для обучения — синтетические диалоги и шаблоны промптов.
- **Гранулярность**: обработка на уровне отдельного запроса мастера в реальном времени (inference по требованию, без батчинга).
- **Горизонт**: не прогноз, а генерация ответа за <3 сек для поддержания темпа игры.
- **Частота пересчета**: fine-tuning модели не требуется на каждой итерации; возможны периодические обновления (раз в квартал) при расширении базы знаний.
- **Архитектура**: LLM API (OpenAI/Anthropic) + RAG для поиска правил, контекст сессии хранится в памяти диалога (окно ~10k токенов).

### 2. Методология `Data Scientist`

#### 2.1. Постановка задачи

Промптим LLM для решения задачи и заводим базовый RAG для поиска по базе

#### 2.2. Блок-схема решения

- Блок-схема для бейзлайна и основного MVP с ключевыми этапами решения задачи: подготовка данных, построение прогнозных моделей, оптимизация, тестирование, закрытие технического долга, подготовка пилота, другое. `Data Scientist`
- [Пример возможной блок схемы](https://github.com/IrinaGoloshchapova/ml_system_design_doc_ru/blob/main/product_schema.png?raw=true)
> Схема обязательно включает в себя архитектуру бейзлайна. Если бейзлайн и основной MVP отличаются несущественно, то это может быть одна блок-схема. Если значительно, то рисуем две: отдельно для бейзлайна, отдельно для основного MVP.
> Если блок-схема **шаблонна** - т.е. её можно скопировать и применить к разным продуктам, то она **некорректна**. Блок-схема должна показывать схему решения для конкретной задачи, поставленной в части 1.

#### 2.3. Этапы решения задачи `Data Scientist`

*Этап 1 - это обычно, подготовка данных.*

Данными для такого ассистента являются книги игроков и книги мастеров - разных тем и миров.
Особенность таких книг в том, что они в основном на английском языке и в формате PDF с картинками. То есть чтобы RAG мог их прочитать, необходимо их отформатировать в текстовый формат.


| Название данных  | Размер | Формат | Язык |
| ------------- | ------------- | ------------- | ------------- |
| A Young Adventurer's Guide - Artificers & Alchemy (5e).pdf | 56.3 MB  | PDF | eng |
| A Young Adventurer's Guide - Beasts & Behemoths (5e).pdf | 73.1 MB  | PDF | eng |
| A Young Adventurer's Guide - Dragons & Treasures (5e).pdf | 20.3 MB  | PDF | eng |
| A Young Adventurer's Guide - Dungeons & Tombs (5e).pdf | 98.9 MB  | PDF | eng |
| A Young Adventurer's Guide - Monsters & Creatures (5e).pdf | 32.1 MB  | PDF | eng |
| A Young Adventurer's Guide - Places & Portals (5e).pdf | 23.1 MB  | PDF | eng |
| A Young Adventurer's Guide - Warriors & Weapons (5e).pdf | 31.3 MB  | PDF | eng |
| A Young Adventurer's Guide - Wizards & Spells (5e).pdf | 6.74 MB  | PDF | eng |
| Chains Of Asmodeus.pdf | 51.7 MB  | PDF | eng |
| D&D 5e DMG24.pdf | 151 MB  | PDF | eng |
| D&D 5e MM24.pdf | 331 MB  | PDF | eng |
| D&D 5e PHB24.pdf | 114 MB  | PDF | eng |
| D&D Essentials Kit.pdf | 42.8 MB  | PDF | eng |
| D&D Starter Set.pdf | 74.1 MB  | PDF | eng |
| Dragonlance - Shadow of the Dragon Queen_.pdf | 63.1 MB  | PDF | eng |
| Dungeon Master's Screen - Baldur's Gate, Descent Into Avernus (GF9 73712 5e).pdf | 22.7 MB  | PDF | eng |
| Dungeon Master's Screen - Curse of Strahd (GF9 73705 5e).pdf | 5.75 MB  | PDF | eng |
| Dungeon Master's Screen - D&D Essentials Kit (C7008 5e).pdf | 11.9 MB  | PDF | eng |
| Dungeon Master's Screen - Dungeon Kit (C9940 5e).pdf | 29 MB  | PDF | eng |
| Dungeon Master's Screen - Elemental Evil (GF9 73702 5e).pdf | 4.87 MB  | PDF | eng |
| Dungeon Master's Screen - Hoard of the Dragon Queen (GF9 73701 5e).pdf | 5.41 MB  | PDF | eng |
| Dungeon Master's Screen - Icewind Dale, Rime of the Frostmaiden (GF9 72714 5e) - MISSING.pdf | 0 Bytes  | PDF | eng |
| Dungeon Master's Screen - Of Ships and the Sea (GF9 73711 5e).pdf | 19.7 MB  | PDF | eng |
| Dungeon Master's Screen - Planescape (D2437 5e).pdf | 13.5 MB  | PDF | eng |
| Dungeon Master's Screen - Rage of Demons (GF9 73704 5e).pdf | 6.43 MB  | PDF | eng |
| Dungeon Master's Screen - Reincarnated (C3687 5e).pdf | 1.81 MB  | PDF | eng |
| Dungeon Master's Screen - Reincarnated (Limited Edition) (C5872 5e).pdf | 2.12 MB  | PDF | eng |
| Dungeon Master's Screen - Storm King's Thunder (GF9 73707 5e).pdf | 6.84 MB  | PDF | eng |
| Dungeon Master's Screen - Tomb of Annihilation (GF9 73708 5e.pdf | 5.83 MB  | PDF | eng |
| Dungeon Master's Screen - Waterdeep, Dragon Heist (GF9 73709 5e).pdf | 9.51 MB  | PDF | eng |
| Dungeon Master's Screen - Waterdeep, Dungeon of the Mad Mage (GF9 73710 5e).pdf | 8.53 MB  | PDF | eng |
| Dungeon Master's Screen - Wilderness Kit (C9185 5e).pdf | 15.2 MB  | PDF | eng |
| Eberron - Rising from the Last War.pdf | 137 MB  | PDF | eng |
| Keys From the Golden Vault.pdf | 70.5 MB  | PDF | eng |
| Out of the Abyss.pdf | 98.8 MB  | PDF | eng |
| Princes of the Apocalypse.pdf | 30.6 MB  | PDF | eng |
| Starter Set - Dragons of Stormwreck Isle.pdf | 64.9 MB  | PDF | eng |
| Sword Coast Adventurer's Guide.pdf | 136 MB  | PDF | eng |
| Tasha's Cauldron of Everything (5e).pdf | 49.9 MB  | PDF | eng |
| The Book of Many Things.pdf | 367 MB  | PDF | eng |
| The Rise of Tiamat.pdf | 8.88 MB  | PDF | eng |
| The Wild Beyond the Witchlight.pdf | 199 MB  | PDF | eng |
| Volo's Guide to Monsters Deluxe (5e).pdf | 69.3 MB  | PDF | eng |
| Wayfinder's Guide to Eberron v3.pdf | 21.3 MB  | PDF | eng |
| Xanathar's Guide to Everything Deluxe (5e).pdf | 83.8 MB  | PDF | eng |

- Краткое описание результата этапа - что должно быть на выходе: витрины данных, потоки данных, др.

> Чаще всего заполнение раздела невозможно без EDA.

 *Этапы 2 и далее, помимо подготовки данных.*

Описание техники **для каждого этапа** должно включать описание **отдельно для MVP** и **отдельно для бейзлайна**:

##### Формирование выборки для обучения, тестирования и валидации

**Бейзлайн:**
- **Тестовая выборка**: 100-150 репрезентативных запросов, покрывающих основные типы задач:
  - Вопросы по правилам (30%): "How does advantage work?", "What is the AC of plate armor?"
  - Генерация NPC (25%): "Create a tavern keeper NPC", "Generate a merchant with personality"
  - Генерация сцен (25%): "Describe a dark forest encounter", "Create a tavern scene"
  - Поиск информации в книгах (20%): "Find information about dragons", "What are the rules for spellcasting?"
- **Валидационная выборка**: 50-70 запросов, аналогичных тестовым, но с другими формулировками
- **Обучающая выборка**: не требуется для бейзлайна (используем предобученные модели без fine-tuning)

**MVP:**
- **Тестовая выборка**: расширена до 200-250 запросов с добавлением:
  - Сложные многошаговые запросы (15%): "Create a combat encounter with 3 goblins and a hobgoblin leader, then generate their tactics"
  - Контекстные запросы (10%): запросы, требующие знания предыдущих сообщений в диалоге
  - Запросы на русском языке (10%): для проверки мультиязычности модели bge-m3
- **Валидационная выборка**: 100 запросов с фокусом на edge cases и сложные сценарии
- **Обучающая выборка**: 500-800 примеров query-document pairs для потенциального fine-tuning reranker'а (если потребуется)
- **Источники данных**: расширенная тестовая группа (15-20 мастеров), логи реальных сессий D&D, синтетические диалоги

##### Горизонт, гранулярность, частота пересчета

**Бейзлайн:**
- **Гранулярность**: обработка на уровне отдельного запроса пользователя (inference по требованию)
- **Горизонт**: генерация ответа за <5 секунд
- **Частота пересчета**: переиндексация FAISS при добавлении новых документов (ручной запуск, не чаще раза в месяц)

**MVP:**
- **Гранулярность**: обработка на уровне отдельного запроса с учетом контекста диалога (окно последних 10-15 сообщений)
- **Горизонт**: генерация ответа за <3 секунды для поддержания темпа игры
- **Частота пересчета**:
  - Автоматическая переиндексация при добавлении документов в базу знаний кампании
  - Периодическая оптимизация гиперпараметров (chunk_size, chunk_overlap) раз в квартал на основе метрик качества

##### Определение целевой переменной

**Бейзлайн:**
- **Целевая переменная**: релевантность извлеченных документов запросу (binary: релевантен/не релевантен)
- **Определение релевантности**: документ считается релевантным, если содержит информацию, необходимую для ответа на запрос (оценка экспертами-мастерами D&D)

**MVP:**
- **Целевая переменная**:
  - Качество финального ответа LLM (composite score):
    - Точность (accuracy): соответствует ли ответ правилам D&D (0-1)
    - Полнота (completeness): покрывает ли ответ все аспекты запроса (0-1)
    - Полезность (usefulness): насколько ответ полезен для мастера/игрока (Likert scale 1-5)
  - Позиция релевантного документа в ранжированном списке (для reranker'а)
- **Определение качества**: оценка экспертами-мастерами D&D и автоматические метрики (BLEU, ROUGE для генеративных задач)

##### ML-метрики и функции потерь

**Бейзлайн:**
- **Метрики retrieval:**
  - **MRR (Mean Reciprocal Rank)**: средняя обратная позиция первого релевантного документа. Целевое значение: MRR ≥ 0.6
  - **Recall@K**: доля релевантных документов среди топ-K результатов. Целевое значение: Recall@5 ≥ 0.7
  - **Precision@K**: доля релевантных документов среди топ-K. Целевое значение: Precision@5 ≥ 0.5
- **Обоснование**: MRR и Recall критичны для RAG, так как пропуск релевантной информации приводит к галлюцинациям LLM. Низкая точность допустима на ранних этапах, так как reranking улучшит её в MVP.
- **Функции потерь**: не используются (используем предобученные эмбеддинги без обучения)

**MVP:**
- **Метрики retrieval:**
  - **MRR**: целевое значение MRR ≥ 0.75 (улучшение на 25% относительно бейзлайна)
  - **Recall@K**: Recall@5 ≥ 0.85, Recall@10 ≥ 0.95
  - **NDCG@K**: Normalized Discounted Cumulative Gain для оценки качества ранжирования. Целевое значение: NDCG@5 ≥ 0.8
  - **Latency**: p50 < 1.5s, p95 < 3s, p99 < 5s
- **Метрики генерации (для LLM ответов):**
  - **Faithfulness**: доля утверждений в ответе, подкрепленных извлеченными документами. Целевое значение: ≥ 0.9
  - **Answer Relevance**: релевантность ответа запросу (semantic similarity). Целевое значение: ≥ 0.8
  - **BLEU/ROUGE**: для генеративных задач (NPC, сцены). Целевое значение: ROUGE-L ≥ 0.6
- **Бизнес-метрики:**
  - **User Satisfaction Score**: средняя оценка полезности ответа (1-5). Целевое значение: ≥ 4.0
  - **Time Saved**: среднее сокращение времени на подготовку сессии. Целевое значение: ≥ 30%
- **Функции потерь (для reranker, если fine-tuning):**
  - **Cross-entropy loss** для задачи бинарной классификации релевантности
  - **Pairwise ranking loss** (например, MarginRankingLoss) для оптимизации порядка документов
- **Обоснование**: метрики выбраны для минимизации галлюцинаций (faithfulness), обеспечения релевантности (MRR, Recall) и соответствия бизнес-целям (time saved, satisfaction). Latency критична для поддержания темпа игры.

##### Схема ML-валидации

**Бейзлайн:**
- **Стратегия валидации**: временное разделение (temporal split)
  - Train: 60% запросов (ранние по времени)
  - Validation: 20% запросов
  - Test: 20% запросов (поздние по времени)
- **Обоснование**: имитирует реальное использование системы, где новые запросы появляются со временем
- **Специфика данных**:
  - Проверка на утечку данных: убедиться, что тестовые запросы не использовались при создании индекса
- **Бизнес-валидация**:
  - Экспертная оценка 20 случайных ответов мастерами D&D
  - Проверка соответствия правилам D&D 5e

**MVP:**
- **Стратегия валидации**: комбинированная
  - **Temporal split**: основной подход (70/15/15)
  - **Stratified split**: по типам запросов для обеспечения покрытия всех сценариев
  - **Group-based split**: разделение по пользователям (train на запросах одних мастеров, test на других) для проверки обобщающей способности
- **Специфика данных**:
  - Учет контекста диалога: валидация на полных диалогах, а не только на отдельных запросах
  - Проверка на distribution shift: сравнение распределения запросов в train/test
  - A/B тестирование: сравнение с бейзлайном на реальных пользователях
- **Бизнес-валидация**:
  - Расширенная экспертная оценка (50+ ответов от 3+ экспертов)
  - Пилотное тестирование с реальными мастерами (≥10 пользователей, ≥200 сессий)
  - Метрики вовлеченности: частота использования, retention rate

##### Структура бейзлайна, предобработка и процесс моделирования

**Бейзлайн:**

*Архитектура:*
- **Retrieval**: FAISS с dense embeddings (BAAI/bge-m3)
- **Chunking**: RecursiveCharacterTextSplitter с chunk_size=700, chunk_overlap=200
- **Embedding**: предобученная модель BAAI/bge-m3 без fine-tuning
- **Ranking**: предобученная модель BAAI/bge-m3-reranker
- **Generation**: LLM API (OpenAI GPT-4 или Anthropic Claude) с базовым промптом

*Предобработка:*
1. Извлечение текста из PDF (PDFMinerLoader)
2. Разбиение на чанки с перекрытием для сохранения контекста
3. Создание эмбеддингов для каждого чанка
4. Индексация в FAISS с L2 distance

*Процесс моделирования:*
1. Запрос пользователя → эмбеддинг запроса
2. Поиск топ-K=5 наиболее похожих чанков по cosine similarity
3. Конкатенация чанков в контекст промпта
4. Генерация ответа LLM с промптом: "Answer the question based on the following context from D&D 5e rules: [context]"

*Ограничения:*
- Фиксированные параметры chunking → могут быть неоптимальны для разных типов контента
- Нет контекста диалога → каждый запрос обрабатывается независимо

**MVP:**

*Архитектура:*
- **Retrieval**: Ensemble retriever (70% FAISS dense, 30% BM25 sparse)
- **Reranking**: Cross-encoder reranker (BAAI/bge-reranker-v2-m3)
- **Chunking**: адаптивный chunking с учетом структуры документа (заголовки, таблицы)
- **Embedding**: BAAI/bge-m3 (возможен fine-tuning на domain-specific данных)
- **Generation**: LLM API с улучшенными промптами для разных типов задач

*Предобработка:*
1. Извлечение текста из PDF с сохранением структуры (заголовки, таблицы, списки)
2. Адаптивное разбиение:
   - Для правил: chunk_size=500-800 (зависит от структуры)
   - Для описаний существ/NPC: chunk_size=300-500
   - Для таблиц: сохранение как единый чанк
3. Метаданные: добавление информации о типе контента, источнике, странице
4. Создание эмбеддингов с нормализацией (если улучшает качество)
5. Индексация в FAISS + создание BM25 индекса

*Процесс моделирования:*
1. Классификация типа запроса (правила/NPC/сцена/другое) → выбор специализированного промпта
2. Извлечение контекста диалога (последние 5-10 сообщений)
3. Поиск документов:
   - Dense retrieval (FAISS): топ-10 кандидатов
   - Sparse retrieval (BM25): топ-10 кандидатов
   - Объединение с весами [0.7, 0.3] → топ-15 кандидатов
4. Reranking: переранжирование топ-15 → топ-5 наиболее релевантных
5. Формирование контекста с учетом метаданных
6. Генерация ответа LLM с task-specific промптом и few-shot примерами

*Улучшения относительно бейзлайна:*
- Ensemble retrieval повышает recall для разных типов запросов
- Reranking улучшает precision и порядок документов
- Контекст диалога позволяет учитывать предыдущие сообщения
- Адаптивный chunking улучшает качество извлечения для разных типов контента

##### Стратегии дальнейшего развития решения

**Выбор моделей:**
- **Embedding модели**: эксперименты с domain-specific моделями (fine-tuning bge-m3 на D&D корпусе), мультимодальные эмбеддинги для изображений из книг
- **Reranker**: fine-tuning cross-encoder на размеченных query-document pairs, эксперименты с более крупными моделями (bge-reranker-large)
- **LLM**: эксперименты с разными провайдерами (GPT-4, Claude, Gemini), использование специализированных моделей для генерации (например, специализация на творческих задачах)

**Предобработка:**
- **Улучшение извлечения из PDF**: использование OCR для сканированных страниц, сохранение форматирования (жирный текст, таблицы)
- **Структурирование данных**: извлечение структурированной информации (статы существ, правила) в отдельные индексы для точного поиска
- **Мультиязычность**: поддержка русского языка для локализованных книг и запросов

**Оптимизация гиперпараметров:**
- **Chunking**: grid search по chunk_size (300-1000) и chunk_overlap (50-300)
- **Retrieval**: оптимизация k (количество документов), весов ensemble retriever
- **Reranking**: оптимизация top_n для reranker'а (баланс между качеством и latency)
- **Промпты**: A/B тестирование различных шаблонов промптов для разных типов задач

**Дальнейшие улучшения:**
- **Граф знаний**: построение knowledge graph для связей между сущностями D&D (существа, заклинания, правила)
- **Мультимодальность**: использование изображений существ, карт для генерации описаний
- **Персонализация**: адаптация под стиль конкретного мастера на основе истории использования

##### Риски этапа и способы их снижения

**Риски бейзлайна:**

1. **Низкое качество retrieval из-за плохого chunking**
   - *Риск*: важная информация разбивается между чанками, теряется контекст
   - *Снижение*: эксперименты с разными chunk_size и chunk_overlap, анализ coverage релевантной информации

2. **Галлюцинации LLM при отсутствии релевантной информации**
   - *Риск*: модель генерирует неправильные правила вместо признания отсутствия информации
   - *Снижение*: промпты с явным указанием отвечать "I don't know" при отсутствии информации, проверка faithfulness метрики

3. **Проблемы с извлечением текста из PDF**
   - *Риск*: потеря структуры, неправильное извлечение таблиц и форматирования
   - *Снижение*: тестирование различных PDF loaders, ручная проверка качества извлечения для ключевых документов

**Риски MVP:**

1. **Увеличение latency из-за reranking и ensemble**
   - *Риск*: добавление компонентов увеличивает время ответа выше SLA (<3s)
   - *Снижение*:
     - Оптимизация: кэширование эмбеддингов запросов, батчинг reranking запросов
     - Параллельное выполнение dense и sparse retrieval
     - Использование более быстрых моделей reranker'а

2. **Переобучение reranker'а на небольшом датасете**
   - *Риск*: модель запоминает паттерны обучающих данных и плохо обобщается
   - *Снижение*:
     - Регуляризация, early stopping
     - Использование предобученных моделей с минимальным fine-tuning
     - Расширение датасета через data augmentation

3. **Нестабильность качества при изменении распределения запросов**
   - *Риск*: модель работает хорошо на тестовых данных, но хуже на реальных запросах пользователей
   - *Снижение*:
     - Мониторинг distribution shift
     - Регулярное обновление тестовой выборки реальными запросами
     - A/B тестирование перед полным развертыванием

4. **Проблемы с контекстом диалога при длинных сессиях**
   - *Риск*: превышение лимита токенов контекста, потеря важной информации
   - *Снижение*:
     - Компрессия истории диалога (summarization старых сообщений)
     - Выборочное включение релевантных сообщений в контекст
     - Ограничение размера окна контекста

##### Необходимый результат этапа

**Бейзлайн:**
- Рабочая RAG-система с базовыми метриками качества:
  - MRR ≥ 0.6
  - Recall@5 ≥ 0.7
  - Latency p95 < 5s
- Индекс FAISS для всех документов D&D
- Базовый API для retrieval и генерации ответов
- Документация по использованию и ограничениям системы

**MVP:**
- Улучшенная RAG-система с метриками:
  - MRR ≥ 0.75 (улучшение на 25% относительно бейзлайна)
  - Recall@5 ≥ 0.85
  - Faithfulness ≥ 0.9
  - Latency p95 < 3s
  - User Satisfaction Score ≥ 4.0
- Полнофункциональный API с поддержкой:
  - Разных типов запросов (правила, NPC, сцены)
  - Контекста диалога
  - Метаданных документов
- Система мониторинга метрик качества и производительности
- Документация и руководство по развертыванию для пилота

### 3. Подготовка пилота

#### 3.1. Способ оценки пилота

- Краткое описание предполагаемого дизайна и способа оценки пилота `Product Owner`, `Data Scientist` with `AB Group`

#### 3.2. Что считаем успешным пилотом

Формализованные в пилоте метрики оценки успешности `Product Owner`

#### 3.3. Подготовка пилота

- Что можем позволить себе, исходя из ожидаемых затрат на вычисления. Если исходно просчитать сложно, то описываем этап расчетов ожидаемой вычислительной сложности на эксперименте с бейзлайном. И предусматриваем уточнение параметров пилота и установку ограничений по вычислительной сложности моделей. `Data Scientist`

### 4. Внедрение `для production систем, если требуется`

> Заполнение раздела 4 требуется не для всех дизайн документов. В некоторых случаях результатом итерации может быть расчет каких-то значений, далее используемых в бизнес-процессе для пилота.

#### 4.1. Архитектура решения

- Блок схема и пояснения: сервисы, назначения, методы API `Data Scientist`

#### 4.2. Описание инфраструктуры и масштабируемости

- Какая инфраструктура выбрана и почему `Data Scientist`
- Плюсы и минусы выбора `Data Scientist`
- Почему финальный выбор лучше других альтернатив `Data Scientist`

#### 4.3. Требования к работе системы

- SLA, пропускная способность и задержка `Data Scientist`

#### 4.4. Безопасность системы

- Потенциальная уязвимость системы `Data Scientist`

#### 4.5. Безопасность данных

- Нет ли нарушений GDPR и других законов `Data Scientist`

#### 4.6. Издержки

- Расчетные издержки на работу системы в месяц `Data Scientist`

#### 4.5. Integration points

- Описание взаимодействия между сервисами (методы API и др.) `Data Scientist`

#### 4.6. Риски

- Описание рисков и неопределенностей, которые стоит предусмотреть `Data Scientist`

> ### Материалы для дополнительного погружения в тему
> - [Шаблон ML System Design Doc [EN] от AWS](https://github.com/eugeneyan/ml-design-docs) и [статья](https://eugeneyan.com/writing/ml-design-docs/) с объяснением каждого раздела
> - [Верхнеуровневый шаблон ML System Design Doc от Google](https://towardsdatascience.com/the-undeniable-importance-of-design-docs-to-data-scientists-421132561f3c) и [описание общих принципов его заполнения](https://towardsdatascience.com/understanding-design-docs-principles-for-achieving-data-scientists-53e6d5ad6f7e).
> - [ML Design Template](https://www.mle-interviews.com/ml-design-template) от ML Engineering Interviews
> - Статья [Design Documents for ML Models](https://medium.com/people-ai-engineering/design-documents-for-ml-models-bbcd30402ff7) на Medium. Верхнеуровневые рекомендации по содержанию дизайн-документа и объяснение, зачем он вообще нужен
> - [Краткий Canvas для ML-проекта от Made with ML](https://madewithml.com/courses/mlops/design/#timeline). Подходит для верхнеуровневого описания идеи, чтобы понять, имеет ли смысл идти дальше.
